services:
  site:
    container_name: site
    image: aloussase/site:latest
    restart: unless-stopped
    platform: linux/amd64
    ports: 
      - "3000:8080"

  dashboard:
    container_name: dashboard
    image: b4bz/homer
    ports:
      - "3001:8080"
    restart: unless-stopped
    volumes:
      - ./dashboard.yml:/www/assets/config.yml

  nginx:
    container_name: nginx
    image: nginx
    volumes:
      - ./jupiter.conf:/etc/nginx/conf.d/default.conf
    ports:
      - "80:80"
    environment:
      - NGINX_HOST=jupiter.local
      - NGINX_PORT=80

  portainer:
    container_name: portainer
    image: portainer/portainer-ce:latest
    ports:
      - "9443:9443"
    volumes:
      - portainer-data:/data
      - /var/run/docker.sock:/var/run/docker.sock
    restart: unless-stopped

  tunnel:
    container_name: cloudflare-tunnel
    image: cloudflare/cloudflared
    restart: unless-stopped
    environment:
      - TUNNEL_TOKEN=$TUNNEL_TOKEN
    command: tunnel --no-autoupdate run

volumes:
  portainer-data: {}
